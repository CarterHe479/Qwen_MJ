ğŸ§  RAG-Qwen3: Retrieval-Augmented Generation with Qwen 0.6B
ä¸€ä¸ªåŸºäºæœ¬åœ°è½»é‡çº§å¤§æ¨¡å‹ Qwen3-0.6B çš„ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿï¼Œæ”¯æŒ æœ¬åœ°é—®ç­”æ¨ç† + PDF æ–‡æ¡£çŸ¥è¯†å¯¼å…¥ + å‘é‡æ£€ç´¢ + rerank ç²¾æ’ + prompt å‹ç¼© + å¯ä¿¡åº¦åˆ¤æ–­ï¼ˆæ‹’ç­”ï¼‰ã€‚

æœ¬é¡¹ç›®åœ¨ MacBook M2 Pro + 16GB å†…å­˜ ä¸‹è¿è¡Œè‰¯å¥½ï¼Œé€‚åˆæœ¬åœ°å­¦ä¹ /å®éªŒ RAG æŠ€æœ¯ã€‚

ğŸ”§ æŠ€æœ¯æ¶æ„
text
å¤åˆ¶
ç¼–è¾‘
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ ç”¨æˆ·è¾“å…¥ Queryâ”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚Query Embedding (text2vec) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ FAISS ç›¸ä¼¼åº¦æ£€ç´¢ â”‚â†â”€â”€â”€â”€ æ–‡æ¡£å‘é‡ï¼ˆç”± SentenceTransformer ç¼–ç ï¼‰
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ å¯é€‰ rerank ç²¾æ’ (bge-reranker) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚Prompt æ„é€ ï¼ˆæ”¯æŒå‹ç¼©+æ‘˜è¦ï¼‰â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚Qwen3-0.6B æœ¬åœ°æ¨ç†ï¼ˆllama-cpp-pythonï¼‰â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ“ é¡¹ç›®ç»“æ„
bash
å¤åˆ¶
ç¼–è¾‘
llm_models/
â”œâ”€â”€ qwen-0.6b-chat/                   # æœ¬åœ° GGUF æ¨¡å‹å­˜æ”¾ç›®å½•
â”‚   â”œâ”€â”€ Qwen3-0.6B-Q2_K.gguf
â”‚   â”œâ”€â”€ Qwen3-0.6B-Q8_0.gguf
â”œâ”€â”€ rag-qwen3/
â”‚   â”œâ”€â”€ rag_demo.py                  # ä¸»å…¥å£ï¼šäº¤äº’å¼é—®ç­”
â”‚   â”œâ”€â”€ rag_llm.py                   # æ£€ç´¢ + Prompt æ„é€  + ä¿¡ä»»æœºåˆ¶
â”‚   â”œâ”€â”€ rag_vectorstore.py          # æ–‡æ¡£å‘é‡æ„å»ºä¸ç´¢å¼•
â”‚   â”œâ”€â”€ pdf_to_chunks.py            # PDF æ–‡æ¡£è¯»å– + åˆ†æ®µå¤„ç†
â”‚   â”œâ”€â”€ rerank_utils.py             # reranker ç²¾æ’æ¨¡å—ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ summarizer.py               # Promptå‹ç¼©æ¨¡å—ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ query_expander.py           # æŸ¥è¯¢æ‰©å±•æ¨¡å—ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ data/kb_docs.txt            # åˆ‡åˆ†åçš„çŸ¥è¯†æ–‡æ¡£ï¼ˆå¯æ›¿æ¢ï¼‰
â”‚   â”œâ”€â”€ faiss.index + docs.pkl      # FAISS ç´¢å¼• + åŸæ–‡ä¿å­˜
ğŸš€ åŠŸèƒ½ç‰¹æ€§
âœ… æœ¬åœ°éƒ¨ç½²çš„å°æ¨¡å‹ï¼ˆQwen3-0.6Bï¼‰
æ— éœ€è”ç½‘ï¼Œæ”¯æŒ CPU/M1/M2 æœ¬åœ°è¿è¡Œã€‚

ä½¿ç”¨ llama-cpp-python åŠ è½½ GGUF æ ¼å¼ã€‚

âœ… PDF æ–‡æ¡£å¯¼å…¥ + æ ‡é¢˜æ„ŸçŸ¥åˆ‡åˆ†
ä½¿ç”¨ PyMuPDF æå–æ–‡æœ¬

ä½¿ç”¨ langchain.text_splitter.RecursiveCharacterTextSplitter æŒ‰æ ‡é¢˜æ®µè½æ™ºèƒ½åˆ‡åˆ†ï¼Œå¹¶åŠ é‡å æ»‘çª—æå‡ä¸Šä¸‹æ–‡è¿ç»­æ€§

âœ… æ£€ç´¢å¢å¼ºï¼ˆRAGï¼‰
ä½¿ç”¨ SentenceTransformer ç”Ÿæˆæ–‡æ¡£å‘é‡

FAISS å‘é‡æ•°æ®åº“æœ¬åœ°æ£€ç´¢

æ”¯æŒ Query Expansion & å¤šå‘é‡èåˆï¼ˆå¯é€‰ï¼‰

âœ… rerank ç²¾æ’å™¨ï¼ˆå¯é€‰ï¼‰
ä½¿ç”¨ BAAI/bge-reranker-base æ‰§è¡Œäº¤äº’å¼ rerank ç²¾æ’

å¾—åˆ†ç”¨äºé‡æ’åºå’Œè¿‡æ»¤ä½ç½®ä¿¡åº¦å†…å®¹

âœ… prompt å‹ç¼©ï¼ˆå¯é€‰ï¼‰
æ”¯æŒæ‘˜è¦åŒ–å¤šä¸ª chunkï¼Œå‹ç¼©ä¸ºå•æ®µ prompt è¾“å…¥ï¼ŒèŠ‚çœ tokenï¼Œæé«˜ä¸Šä¸‹æ–‡èšç„¦èƒ½åŠ›

âœ… ä¿¡ä»»æœºåˆ¶ï¼ˆä½ç›¸å…³åº¦æ‹’ç­”ï¼‰
å¦‚æœæ£€ç´¢å†…å®¹ä¸ query ç›¸ä¼¼åº¦è¿‡ä½ï¼ˆå¯è®¾é˜ˆå€¼ï¼‰ï¼Œå°†æ‹’ç»æ„é€  RAG promptï¼Œè¾“å‡ºâ€œæœªä½¿ç”¨çŸ¥è¯†åº“â€çš„ LLM å›ç­”

ğŸ› ï¸ å®‰è£…ç¯å¢ƒ
ä½¿ç”¨ Conda åˆ›å»ºç¯å¢ƒï¼š

bash
å¤åˆ¶
ç¼–è¾‘
conda create -n qwen3-env python=3.10
conda activate qwen3-env
pip install -r requirements.txt
å¦‚æœç½‘ç»œä¸ç•…ï¼Œå¯ä½¿ç”¨æ¸…å/ä¸­ç§‘å¤§é•œåƒæˆ–æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹åˆ°ï¼š

bash
å¤åˆ¶
ç¼–è¾‘
rag-qwen3/hf_model/bge-reranker-base/
ğŸ§ª è¿è¡Œ Demo
bash
å¤åˆ¶
ç¼–è¾‘
cd rag-qwen3
python3 rag_demo.py
è¾“å…¥è‡ªç„¶è¯­è¨€é—®é¢˜ï¼Œå³å¯è¿”å›å›ç­”ã€‚

ğŸ§¹ .gitignore å»ºè®®
gitignore
å¤åˆ¶
ç¼–è¾‘
# ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶
__pycache__/
*.py[cod]
*.pkl
*.index
*.DS_Store

# æ¨¡å‹æ–‡ä»¶
*.gguf
*.bin
*.pt

# PDFã€å‘é‡åº“å’Œæ–‡æ¡£æ•°æ®
*.pdf
data/kb_docs.txt
docs.pkl
faiss.index

# HF ä¸‹è½½æ¨¡å‹
rag-qwen3/hf_model/
ğŸ“Œ TODO
 æ”¯æŒåŸºç¡€æ£€ç´¢ä¸é—®ç­”

 æ”¯æŒ PDF æ–‡æ¡£è¾“å…¥

 Prompt å‹ç¼©

 reranker ç²¾æ’

 æŸ¥è¯¢æ‰©å±• + å‘é‡èåˆï¼ˆå¤š query æ¨¡å¼ï¼‰

 ä¿¡ä»»æœºåˆ¶ + æ‹’ç­”

 WebUI æ¥å£ï¼ˆå¦‚ gradio / streamlitï¼‰

 LangChain / RAGasLib æ¶æ„æ›¿ä»£ï¼ˆå¯é€‰ï¼‰

ğŸ“š å‚è€ƒ
Qwen3 by Alibaba: https://huggingface.co/Qwen

SentenceTransformers: https://www.sbert.net

FAISS: Facebook AI Similarity Search

bge-reranker: BAAI å¼€æºç²¾æ’å™¨

llama-cpp-python: C++ æ¨ç†å¼•æ“ç»‘å®š
